# Line Break Cleaner - 使用方法

## 概要
このFigmaプラグインは、HTML to designで発生するテキストノードの改行問題を解決し、デザイナーの改行とソフト改行の混同問題を修正します。

## 主な機能

### 1. Auto-width → Auto-height変換
- `textAutoResize: "WIDTH_AND_HEIGHT"`のテキストノードを検出
- 自動的に`textAutoResize: "HEIGHT"`に変換
- 不要な改行を除去してテキストを最適化

### 2. Edge-breaking検出と修正
- コンテナ幅に対して一定比率以上の行を検出
- 見かけ上の改行位置で改行文字が入った問題を修正
- 句読点で終わる行は改行を保持（デザイナーの意図を尊重）

### 3. ソフト改行の変換
- ソフト改行文字（U+2028など）を通常の改行文字に変換
- paragraph spacing設定があるテキストノードは処理をスキップ

## 使用方法

### 基本操作
1. Figmaでプラグインを起動
2. 「スキャン実行」ボタンをクリック
3. 検出された問題のあるテキストノードを確認
4. 必要に応じて個別に選択して処理

### 手動選択ツール
1. Figmaで処理したいテキストノードを選択
2. プラグインの「選択中のノードに適用」をクリック
3. 処理オプションを選択：
   - 改行除去：不要な改行を除去
   - ソフト改行は改行に変換：ソフト改行文字を通常改行に変換

### 設定項目

#### 検出設定
- **最小文字数**: 処理対象とする最小文字数（デフォルト: 20）
- **改行処理閾値**: コンテナ幅に対する比率（デフォルト: 0.8）
- **フォント幅係数**: 文字幅推定の調整係数（デフォルト: 1.0）
- **ソフト改行文字**: 検出・変換対象のソフト改行文字

#### 検出タイプ
- **右端改行検出**: コンテナ右端での改行を検出
- **ソフト改行検出**: ソフト改行文字を検出

## 処理ロジック

### 改行除去の判定基準
1. **句読点で終わる行**: 改行を保持（デザイナーの意図）
2. **箇条書き**: 改行を保持
3. **英大文字で始まる行**: 改行を保持（新しい文）
4. **上記以外**: コンテナ幅比率に基づいて改行除去を判定

### 日本語テキストの特別処理
- 日本語文字同士の結合：スペースなしで結合
- 英数字との境界：スペースを挿入して結合
- 句読点（。．！？）での改行保持

## 安全機能
- **Missing font チェック**: フォントが見つからないノードはスキップ
- **ロックされたレイヤー**: 処理をスキップ
- **非表示レイヤー**: 処理をスキップ
- **バッチ処理**: 大量のノードも安全に処理

## トラブルシューティング

### よくある問題
1. **フォントエラー**: Missing fontのノードは処理できません
2. **ロックエラー**: ロックされたレイヤーは処理できません
3. **選択なし**: テキストノードが選択されていない場合はエラー

### 推奨設定
- **日本語メイン**: フォント幅係数 1.0、改行処理閾値 0.8
- **英語メイン**: フォント幅係数 0.9、改行処理閾値 0.85
- **混在テキスト**: フォント幅係数 0.95、改行処理閾値 0.8

## 技術仕様
- **対応文字**: 日本語（ひらがな、カタカナ、漢字）、英数字、記号
- **ソフト改行文字**: U+2028（Line Separator）がデフォルト
- **処理方式**: 非同期バッチ処理でUI応答性を確保
- **メモリ効率**: チャンク処理で大容量ファイルに対応